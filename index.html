<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学情分析系统</title>
    <!-- 引入Element Plus样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            height: 100vh;
        }

        /* 登录页样式 */
        .login-container {
            width: 400px;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #303133;
            font-size: 24px;
        }

        .login-form {
            margin-top: 20px;
        }

        .login-button {
            width: 100%;
            margin-top: 20px;
        }

        /* 主页样式 */
        .main-container {
            width: 100%;
            height: calc(100vh + 50px);
            display: flex;
            flex-direction: column;
        }

        .header {
            height: 60px;
            background-color: #fff;
            border-bottom: 1px solid #dcdfe6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo {
            color: #333;
            font-size: 35px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .content-container {
            flex: 1;
            display: flex;
            background-color: #f5f7fa;
        }

        .sidebar {
            width: 240px;
            background-color: #304156;
            height: calc(100vh - 60px);
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page-title {
            margin-bottom: 20px;
            font-size: 24px;
            color: #181818;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-title .el-icon {
            font-size: 24px;
        }

        .content-buttons {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .el-menu {
            border-right: none !important;
        }

        .logout-link {
            color: #409eff;
            cursor: pointer;
        }

        .logout-link:hover {
            color: #66b1ff;
        }

        /* 新增样式 */
        .page-header {
            margin-bottom: 20px;
        }

        .student-info {
            font-size: 20px;
            margin: 20px 0 30px 0;
        }

        .student-name {
            color: #f56c6c;
            font-weight: bold;
        }

        .analysis-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .analysis-buttons .el-button {
            min-width: 120px;
        }

        .page-content {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        }

        /* 首页样式 */
        .welcome-info {
            padding: 20px;
        }

        .welcome-info h2 {
            color: #303133;
            margin-bottom: 20px;
        }

        .welcome-info p {
            color: #606266;
            margin-bottom: 15px;
        }

        .welcome-info ul {
            color: #606266;
            padding-left: 20px;
        }

        .welcome-info li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .student-selection-container {
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: relative;
            align-items: flex-start;
        }

        .dropdown-container {
            position: relative;
        }

        .menu-dropdown {
            position: absolute;
            left: 0;
            top: 100%;
            background: white;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            padding: 5px;
            min-width: 150px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .menu-dropdown .el-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            text-align: left;
            white-space: nowrap;
        }

        .student-selection {
            position: absolute;
            left: 0;
            top: calc(100% + 5px);
            background: white;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            padding: 20px;
            min-width: 280px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            z-index: 10;
            text-align: left;
        }

        .student-selection .el-radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .selection-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ebeef5;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .student-selection .selection-title {
            font-size: 16px;
            color: #606266;
            margin-bottom: 15px;
        }

        .student-radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .student-radio-group .el-radio {
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 4px;
            transition: all 0.3s;
            width: 100%;
        }

        .student-radio-group .el-radio.is-bordered {
            border-color: #dcdfe6;
        }

        .student-radio-group .el-radio.is-bordered.is-checked {
            border-color: #409eff;
            background-color: #ecf5ff;
        }

        .selection-title {
            margin-bottom: 20px;
            color: #303133;
            font-size: 20px;
        }

        .search-input {
            width: 300px;
            margin-bottom: 20px;
        }

        .filter-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-buttons .el-button {
            min-width: 180px;
        }

        .student-list {
            margin: 20px 0;
        }

        .radio-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .confirm-button {
            margin-top: 20px;
            text-align: center;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            display: block;
            position: absolute;
            background-color: transparent;
            z-index: 1;
            border-radius: 4px;
            padding: 10px 0;
        }

        .dropdown-item {
            display: block;
            padding: 10px 15px;
            color: #ffffff;
            text-align: center;
            width: 150px;
            transition: background-color 0.3s;
            border-radius: 4px;
            margin-left: 0;
        }

        .dropdown-item:nth-child(1) {
            background-color: #67c23a; /* 文学院 */
        }

        .dropdown-item:nth-child(2) {
            background-color: #409eff; /* 新科学院 */
        }

        .dropdown-item:nth-child(3) {
            background-color: #f56c6c; /* 外语学院 */
        }

        .dropdown-item:nth-child(4) {
            background-color: #67c23a; /* 专业 */
        }

        .dropdown-item:nth-child(5) {
            background-color: #409eff; /* 平行班 */
        }

        .dropdown-item:nth-child(6) {
            background-color: #f56c6c; /* 自然班 */
        }

        .dropdown-item:hover {
            opacity: 0.8;
            cursor: pointer;
        }

        .dropdown-item:active {
            opacity: 0.6;
        }

        .college-dropdown {
            position: relative;
            display: inline-block;
        }

        .college-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
            z-index: 1000;
            margin-top: 5px;
            min-width: 120px;
        }

        .college-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .college-item:hover {
            background-color: #f5f7fa;
            color: #409eff;
        }

        .student-radio-group {
            padding: 30px;
        }
        .radio-group-vertical {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .radio-group-vertical .el-radio {
            margin: 0;
            padding-left: 20px;
            height: 40px;
            line-height: 40px;
        }
        .el-radio__inner {
            margin-left: 0;
        }
        .el-radio__label {
            padding-left: 25px;
        }
        .dialog-footer {
            text-align: right;
            padding: 10px 20px;
        }
        .el-dialog__header {
            margin: 0;
            padding: 15px 20px;
            border-bottom: 1px solid #dcdfe6;
        }
        .el-dialog__title {
            font-size: 16px;
            font-weight: 500;
        }
        .el-dialog__headerbtn {
            top: 15px;
        }
        .el-button--primary.dialog-confirm {
            padding: 8px 20px;
            font-size: 14px;
            border-radius: 4px;
        }

        /* 添加在现有样式表末尾 */
        .filter-item {
            margin-right: 15px;
            position: relative;
        }
        
        .el-dropdown-link {
            cursor: pointer;
            color: #409EFF;
            display: flex;
            align-items: center;
            background-color: #ecf5ff;
            border: 1px solid #d9ecff;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .el-dropdown-link:hover {
            background-color: #409EFF;
            color: white;
            border-color: #409EFF;
        }
        
        .el-dropdown-link .el-icon {
            margin-left: 5px;
        }
        
        .el-tag {
            margin-top: 8px;
        }
        
        .el-tag + .el-tag {
            margin-left: 5px;
        }

        /* 新增搜索选项和结果表格样式 */
        .filter-options {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
            gap: 15px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 20px;
            width: 100%;
        }

        .filter-item {
            flex: 1;
            min-width: 200px;
        }

        .filter-item .el-form-item {
            margin-bottom: 0;
        }

        .filter-item .el-form-item__label {
            font-weight: normal;
            color: #606266;
        }

        .search-results {
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-results .el-table {
            margin-top: 10px;
        }

        .search-results .el-table th {
            background-color: #f5f7fa;
            color: #606266;
            font-weight: 600;
        }

        .search-results .el-table td {
            padding: 12px 0;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="main-container">
            <!-- 顶部导航 -->
            <header class="header">
                <div class="logo">学情分析</div>
                <div class="user-info">
                    <span>欢迎用户：{{ username }}</span>
                    <span class="logout-link" @click="handleLogout">退出</span>
                </div>
            </header>
            
            <!-- 主要内容区域 -->
            <div class="content-container">
                <!-- 左侧导航 -->
                <aside class="sidebar">
                    <el-menu
                        :default-active="activeMenu"
                        class="el-menu-vertical"
                        background-color="#304156"
                        text-color="#fff"
                        active-text-color="#409eff"
                        unique-opened
                        @select="handleSelect"
                    >


                     <!-- 院系管理 -->
                     <el-sub-menu index="6">
                        <template #title>
                            <el-icon><School /></el-icon>
                            <span>院系管理</span>
                        </template>
                        <el-menu-item index="6-1">学院管理</el-menu-item>
                        <el-menu-item index="6-2">专业管理</el-menu-item>
                    </el-sub-menu>
                        <!-- 课程管理 -->
                        <el-sub-menu index="1" :popper-append-to="false">
                            <template #title>
                                <el-icon><School /></el-icon>
                                <span>课程管理</span>
                            </template>
                            <el-menu-item index="1-1" @click="goToCreateCourse">创建课程</el-menu-item>
                            <el-menu-item index="1-2" @click="goToAddParallelClass">添加平行班</el-menu-item>
                            <el-menu-item index="1-3" @click="goToStudentManagement">学生管理</el-menu-item>
                        </el-sub-menu>

                        <!-- 成绩管理 -->
                        <el-sub-menu index="2" :popper-append-to="false">
                            <template #title>
                                <el-icon><Document /></el-icon>
                                <span>方案与成绩管理</span>
                            </template>
                            <el-menu-item index="2-1">作业方案管理</el-menu-item>
                            <el-menu-item index="2-3">考试方案管理</el-menu-item> 
                            <el-menu-item index="2-2">成绩管理</el-menu-item>
                        </el-sub-menu>

                        <!-- 其他菜单项 -->
                        <el-menu-item index="3">
                            <el-icon><Document /></el-icon>
                            <span>学情分析</span>
                        </el-menu-item>
                        <el-menu-item index="4" @click="goToTeacherAnalysis">
                            <el-icon><User /></el-icon>
                            <span>教师分析</span>
                        </el-menu-item>
                        <el-menu-item index="5" @click="goToUserManagement">
                            <el-icon><Setting /></el-icon>
                            <span>用户权限管理</span>
                        </el-menu-item>
                    </el-menu>
                </aside>

                <!-- 右侧内容区域 -->
                <main class="main-content">
                    <!-- 首页内容 -->
                    <div v-if="currentPage === 'home'">
                        <div class="page-title">
                            <el-icon><HomeFilled /></el-icon>
                            <span>首页</span>
                        </div>
                        <div class="page-content">
                            <div class="welcome-info">
                                <h2>欢迎使用学情分析系统</h2>
                                <p>这里是系统的首页，您可以：</p>
                                <ul>
                                    <li>在左侧菜单选择需要的功能</li>
                                    <li>查看课程管理</li>
                                    <li>管理学生成绩</li>
                                    <li>进行学情分析</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 学情分析页面 -->
                    <div v-if="currentPage === '3'">
                        <div class="page-title">
                            <span>学情分析</span>
                        </div>
                        <div class="content-buttons">
                            <el-button type="primary" @click="handleIndividualAnalysis">学生个体</el-button>
                            <el-button type="primary" @click="navigateToGroupAnalysis">群体</el-button>
                        </div>
                    </div>

                    <!-- 选择学生页面 -->
                    <div v-if="currentPage === 'individual'">
                        <div class="page-header">
                            <el-button @click="backToAnalysis" type="primary" plain size="small">
                                <el-icon><Back /></el-icon> 返回
                            </el-button>
                        </div>
                        <div class="student-selection-container">
                            <h2 class="selection-title">请选择您要分析的选项：</h2>
                            <el-form :model="searchForm">
                                <div class="filter-options">
                                    <!-- First row: 学院 and 专业 -->
                                    <div class="filter-row">
                                        <!-- 学院选择 -->
                                        <div class="filter-item">
                                            <el-form-item label="学院">
                                                <el-select 
                                                    v-model="searchForm.college" 
                                                    filterable 
                                                    placeholder="请选择或输入学院"
                                                    clearable
                                                    @change="handleFilterChange(1)">
                                                    <el-option
                                                        v-for="college in colleges"
                                                        :key="college"
                                                        :label="college"
                                                        :value="college">
                                                    </el-option>
                                                </el-select>
                                            </el-form-item>
                                        </div>

                                        <!-- 专业选择 -->
                                        <div class="filter-item">
                                            <el-form-item label="专业">
                                                <el-select 
                                                    v-model="searchForm.major" 
                                                    filterable 
                                                    placeholder="请选择或输入专业"
                                                    clearable
                                                    @change="handleFilterChange(2)">
                                                    <el-option
                                                        v-for="major in majors"
                                                        :key="major"
                                                        :label="major"
                                                        :value="major">
                                                    </el-option>
                                                </el-select>
                                            </el-form-item>
                                        </div>
                                    </div>

                                    <!-- Second row: 平行班 and 自然班 -->
                                    <div class="filter-row">
                                        <!-- 平行班选择 -->
                                        <div class="filter-item">
                                            <el-form-item label="平行班">
                                                <el-select 
                                                    v-model="searchForm.parallelClass" 
                                                    filterable 
                                                    placeholder="请选择或输入平行班"
                                                    clearable
                                                    @change="handleFilterChange(3)">
                                                    <el-option
                                                        v-for="item in parallelClassOptions"
                                                        :key="item"
                                                        :label="item"
                                                        :value="item">
                                                    </el-option>
                                                </el-select>
                                            </el-form-item>
                                        </div>

                                        <!-- 自然班选择 -->
                                        <div class="filter-item">
                                            <el-form-item label="自然班">
                                                <el-select 
                                                    v-model="searchForm.naturalClass" 
                                                    filterable 
                                                    placeholder="请选择或输入自然班"
                                                    clearable
                                                    @change="handleFilterChange(4)">
                                                    <el-option
                                                        v-for="item in naturalClassOptions"
                                                        :key="item"
                                                        :label="item"
                                                        :value="item">
                                                    </el-option>
                                                </el-select>
                                            </el-form-item>
                                        </div>
                                    </div>
                                </div>
                            </el-form>

                            <!-- 搜索结果表格 -->
                            <div class="search-results">
                                <el-table :data="studentData" style="width: 100%">
                                    <el-table-column prop="studentId" label="学号" width="150"></el-table-column>
                                    <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                                    <el-table-column prop="examName" label="考试名称" width="150"></el-table-column>
                                    <el-table-column prop="type" label="类型" width="120"></el-table-column>
                                    <el-table-column prop="course" label="课程" width="120"></el-table-column>
                                    <el-table-column prop="parallelClass" label="平行班" width="120"></el-table-column>
                                    <el-table-column prop="major" label="专业" width="150"></el-table-column>
                                    <el-table-column prop="score" label="成绩" width="100"></el-table-column>
                                    <el-table-column label="操作" width="120">
                                        <template #default="scope">
                                            <el-button 
                                                size="small" 
                                                type="primary"
                                                @click="handleSelectStudent(scope.row)">
                                                选择
                                            </el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </div>
                        <el-dialog 
                            v-model="modalVisible" 
                            :title="modalTitle"
                            width="400px"
                            :close-on-click-modal="false"
                            :show-close="true"
                            @close="handleDialogClose">
                            <div class="student-radio-group">
                                <el-radio-group v-model="selectedStudentRadio" class="radio-group-vertical">
                                    <el-radio v-for="student in students" :key="student" :label="student" border>
                                        {{ student }}
                                    </el-radio>
                                </el-radio-group>
                            </div>
                            <template #footer>
                                <span class="dialog-footer">
                                    <el-button type="primary" class="dialog-confirm" @click="confirmSelection">确定</el-button>
                                </span>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- 学生详细分析页面 -->
                    <div v-if="currentPage === 'student-detail'">
                        <div class="page-header">
                            <el-button @click="backToIndividual" type="primary" plain size="small">
                                <el-icon><Back /></el-icon> 返回
                            </el-button>
                        </div>
                        <div class="student-info">
                            您选择了 <span class="student-name">{{ selectedStudentRadio }}</span> 同学
                            <span v-if="selectedStudent">（来自{{ selectedStudent }}）</span>
                        </div>
                        <div class="analysis-buttons">
                            <el-button type="primary" @click="handleAnalysisClick('participation')">
                                学生参与度
                            </el-button>
                            <el-button type="primary" @click="handleAnalysisClick('grades')">
                                成绩情况
                            </el-button>
                            <el-button type="primary" @click="handleAnalysisClick('strategy')">
                                应试策略
                            </el-button>
                            <el-button type="primary" @click="handleAnalysisClick('warning')">
                                成绩预警
                            </el-button>
                            <el-button type="primary" @click="handleAnalysisClick('prediction')">
                                成绩预测
                            </el-button>
                        </div>
                    </div>

                    <!-- 课程管理相关页面 -->
                    <div v-if="currentPage === '1-1'">
                        <div class="page-title">创建课程</div>
                        <div class="page-content">这里是创建新课程的表单界面</div>
                    </div>
                    <div v-if="currentPage === '1-2'">
                        <div class="page-title">添加平行班</div>
                        <div class="page-content">这里可以为现有课程添加平行班级</div>
                    </div>
                    <div v-if="currentPage === '1-3'">
                        <div class="page-title">学生管理</div>
                        <div class="page-content">这里可以管理课程中的学生信息</div>
                    </div>

                    <!-- 成绩管理相关页面 -->
                    <div v-if="currentPage === '2-1'">
                        <div class="page-title">作业成绩上传</div>
                        <div class="page-content">这里可以上传学生的作业成绩</div>
                    </div>
                    <div v-if="currentPage === '2-2'">
                        <div class="page-title">作业成绩修改</div>
                        <div class="page-content">这里可以修改已上传的作业成绩</div>
                    </div>
                    <div v-if="currentPage === '2-3'">
                        <div class="page-title">作业成绩考试</div>
                        <div class="page-content">这里可以管理学生的考试成绩</div>
                    </div>

                    <!-- 其他菜单页面（除了学情分析） -->
                    <div v-if="currentPage === '4'">
                        <div class="page-title">教师分析</div>
                        <div class="page-content">
                            <el-button type="primary" @click="goToTeacherAnalysis">进入教师分析</el-button>
                        </div>
                    </div>
                    <div v-if="currentPage === '5'">
                        <div class="page-title">用户权限管理</div>
                        <div class="page-content">
                            <el-button type="primary" @click="goToUserManagement">进入用户权限管理</el-button>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <script src="./js/axios.min.js"></script>
    <script>
        const { createApp, ref, onMounted, computed } = Vue;
        const { ElMessage } = ElementPlus;

        const app = createApp({
            setup() {
                const currentPage = ref('home');
                const activeMenu = ref('home');
                const username = ref('');
                const searchQuery = ref('');
                const selectedStudent = ref('');
                const showStudentList = ref(false);
                const modalVisible = ref(false);
                const modalTitle = ref('');
                const showDropdown = ref(false);
                const showCollegeMenu = ref(false);
                const showMajorMenu = ref(false);
                const showParallelClassMenu = ref(false);
                const showNaturalClassMenu = ref(false);
                const colleges = ref(['国际中文学院','汉学与中国学学院','应用中文学院','英语学院',
'高级翻译学院','应用外语学院','东方语言文化学院','西方语言文化学院',
'教师教育学院','文学院','国际关系学院','新闻传播学院','信息科学学院',
'商学院','马克思主义学院',
'艺术学院','语言康复学院','语言学系心理学院',
'继续教育学院','网络教育学院']);
                const majors = ref(['汉语言', '英语', '法语', '日语', '汉语国际教育', '西班牙语', 
                    '朝鲜语', '汉语言文学', '计算机科学与技术', '金融学', '德语', 
                    '绘画', '信息管理与信息系统', '会计学', '国际经济与贸易', 
                    '国际政治', '翻译', '新闻学', '数字媒体技术', '意大利语', 
                    '葡萄牙语', '国际事务与国际关系', '人力资源管理', '俄语', 
                    '财务管理', '特殊教育', '音乐学', '书法学', '土耳其语', 
                    '印度尼西亚语', '罗马尼亚语', '语言学', '商务英语', 
                    '网络与新媒体', '心理学', '经济学', '波斯语', '人工智能']);
                const selectedStudentRadio = ref('');
                const students = ref(['张三', '李四', '王五', '赵六', '钱七', '孙八']);
                const selectedParallelClasses = ref([]);
                const selectedNaturalClasses = ref([]);
                
                // 新增结构化的搜索表单和结果
                const searchForm = ref({
                    college: '',
                    major: '',
                    parallelClass: '',
                    naturalClass: ''
                });
                
                // 平行班和自然班选项
                const parallelClassOptions = ref(['平行班1', '平行班2', '平行班3', '平行班4', '平行班5']);
                const naturalClassOptions = ref(['自然班1', '自然班2', '自然班3', '自然班4', '自然班5']);
                
                // 模拟学生成绩数据
                const studentData = ref([]
                //     [
                //     {
                //         studentId: '202300000001',
                //         name: '张三',
                //         examName: '第一次考试',
                //         type: '平时考试',
                //         course: '数学',
                //         parallelClass: '平行班1',
                //         naturalClass: '自然班1',
                //         college: '信息科学学院',
                //         major: '计算机科学与技术',
                //         score: 85
                //     },
                //     {
                //         studentId: '202300000002',
                //         name: '李四',
                //         examName: '期中考试',
                //         type: '期中考试',
                //         course: '英语',
                //         parallelClass: '平行班2',
                //         naturalClass: '自然班2',
                //         college: '软件学院',
                //         major: '软件工程',
                //         score: 92
                //     },
                //     {
                //         studentId: '202300000003',
                //         name: '王五',
                //         examName: '第二次考试',
                //         type: '平时考试',
                //         course: '物理',
                //         parallelClass: '平行班1',
                //         naturalClass: '自然班1',
                //         college: '信息科学学院',
                //         major: '计算机科学与技术',
                //         score: 78
                //     },
                //     {
                //         studentId: '202300000004',
                //         name: '赵六',
                //         examName: '期末考试',
                //         type: '期末考试',
                //         course: '高等数学',
                //         parallelClass: '平行班3',
                //         naturalClass: '自然班3',
                //         college: '人工智能学院',
                //         major: '人工智能',
                //         score: 88
                //     }
                // ]
            ); 
                
                // 根据筛选条件过滤学生数据
                // const filteredStudentData = computed(() => {
                //     return studentData.value.filter(student => {
                //         const collegeMatch = !searchForm.value.college || student.college === searchForm.value.college;
                //         const majorMatch = !searchForm.value.major || student.major === searchForm.value.major;
                //         const parallelClassMatch = !searchForm.value.parallelClass || student.parallelClass === searchForm.value.parallelClass;
                //         const naturalClassMatch = !searchForm.value.naturalClass || student.naturalClass === searchForm.value.naturalClass;
                        
                //         return collegeMatch && majorMatch && parallelClassMatch && naturalClassMatch;
                //     });
                // });
                
                // 处理筛选条件变化
                const handleFilterChange = (val) => {
                    // 当筛选条件变化时，可以在这里添加额外逻辑
                    console.log('筛选条件变化:', searchForm.value);
                    if(val==3){
                        axios.post('http://101.42.28.87:8888/api/getParallelStu',{'course_id':'1',semester:'1',
                            'parallel_id':'9'}).then(res=>{
                                console.log(res)
                            })
                    }else{
                        if(searchForm.value.parallelClass){
                        if(searchForm.value.college){
                            axios.post('http://101.42.28.87:8888/api/getCollegeStu',{'course_id':'1',semester:'1',
                            'parallel_id':'9',college:""}).then(res=>{
                                console.log(res)
                            })
                        }
                        if(searchForm.value.naturalClass){
                            axios.post('http://101.42.28.87:8888/api/getClassStu',{'course_id':'1',semester:'1',
                            'parallel_id':'9',college:"",class:""}).then(res=>{
                                console.log(res)
                            })
                        }
                        if(searchForm.value.major){
                            axios.post('http://101.42.28.87:8888/api/getMajorStu',{'course_id':'1',semester:'1',
                            'parallel_id':'9',major:''}).then(res=>{
                                console.log(res)
                            })
                        }
                       
                    }
                    }
                 
                   
                    // axios.post('http://101.42.28.87:8888/api/getCollegeStu',{'course_id':'1',semester:'1',
                    //     'parallel_id':'1',college:""}).then(res=>{
                    //         console.log(res)
                    //     })
                        
                };
                
                // 选择学生
                const handleSelectStudent = (student) => {
                    selectedStudentRadio.value = student.name;
                    selectedStudent.value = `${student.major} - ${student.parallelClass}`;
                    ElMessage.success(`已选择 ${student.name} 同学`);
                    currentPage.value = 'student-detail';
                };

                // 检查登录状态
                onMounted(() => {
                    const isLoggedIn = localStorage.getItem('isLoggedIn');
                    const storedUsername = localStorage.getItem('username');
                    
                    if (!isLoggedIn || !storedUsername) {
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    username.value = storedUsername;
                    
                    axios.post('http://101.42.28.87:8888/api/getParallelStu',{'course_id':'1',semester:'2024-2025-1',
                    'parallel_id':'1'}).then(res=>{
                        console.log(res)
                    })
                    // 默认显示学情分析页面，而不是欢迎页面
                    currentPage.value = '3';
                    activeMenu.value = '3';
                    
                    // 检查URL中是否有锚点，如果有#3则确保显示学情分析页面
                    if (window.location.hash === '#3') {
                        currentPage.value = '3';
                        activeMenu.value = '3';
                    }
                    
                    // 从localStorage加载学院数据并与默认列表合并
                    const savedColleges = localStorage.getItem('colleges');
                    if (savedColleges) {
                        const parsedColleges = JSON.parse(savedColleges);
                        // 从学院对象数组中提取学院名称
                        const collegeNames = parsedColleges.map(college => college.collegeName);
                        
                        // 过滤掉已存在于默认列表中的学院名称
                        const newColleges = collegeNames.filter(name => 
                            name && name.trim() !== '' && !colleges.value.includes(name)
                        );
                        
                        // 将新的学院放在列表的最前面
                        colleges.value = [...newColleges, ...colleges.value];
                    }
                    
                    // 从localStorage加载专业数据并与默认列表合并
                    const savedMajors = localStorage.getItem('majors');
                    if (savedMajors) {
                        const parsedMajors = JSON.parse(savedMajors);
                        // 从专业对象数组中提取专业名称
                        const majorNames = parsedMajors.map(major => major.majorName);
                        
                        // 过滤掉已存在于默认列表中的专业名称
                        const newMajors = majorNames.filter(name => 
                            name && name.trim() !== '' && !majors.value.includes(name)
                        );
                        
                        // 将新的专业放在列表的最前面
                        majors.value = [...newMajors, ...majors.value];
                    }
                });

                // 处理登出
                const handleLogout = () => {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('username');
                    window.location.href = 'login.html';
                };

                // 处理学生个体分析
                const handleIndividualAnalysis = () => {
                    currentPage.value = 'individual';
                    showStudentList.value = false;
                };

                // 显示学生详细页面
                const showStudentDetail = () => {
                    currentPage.value = 'student-detail';
                };

                // 返回个体分析页面
                const backToIndividual = () => {
                    currentPage.value = 'individual';
                };

                // 返回分析页面
                const backToAnalysis = () => {
                    currentPage.value = '3';
                };

                // 返回首页
                const backToHome = () => {
                    currentPage.value = 'home';
                };

                // 处理分析按钮点击
                const handleAnalysisClick = (type) => {
                    ElMessage.info(`点击了${type}分析按钮`);
                };

                // 监听菜单项点击
                const handleSelect = (index) => {
                    switch(index) {
                        case '1-1':
                            window.location.href = './pages/create-course.html';
                            break;
                        case '1-2':
                            window.location.href = './pages/add-parallel-class.html';
                            break;
                        case '1-3':
                            window.location.href = './pages/student-management.html';
                            break;
                        case '2-1':
                            window.location.href = './pages/homework-upload.html';
                            break;
                        case '2-2':
                            window.location.href = './pages/homework-edit.html';
                            break;
                        case '2-3':
                            window.location.href = './pages/homework-exam.html';
                            break;
                        case '3':
                            // Handle internal navigation for learning analysis
                            currentPage.value = index;
                            break;
                        case '4':
                            window.location.href = './pages/teacher-analysis.html';
                            break;
                        case '5':
                            window.location.href = './pages/user-management.html';
                            break;
                        case '6-1':
                            window.location.href = './pages/create-colleges.html';
                            break;
                        case '6-2':
                            window.location.href = './pages/major-management.html';
                            break;
                        default:
                            // For other internal pages
                            currentPage.value = index;
                    }
                };

                // 处理学院选择
                const handleCollegeSelect = (college) => {
                    selectedStudent.value = college;
                    showCollegeMenu.value = false;
                    // 重置选中状态
                    selectedStudentRadio.value = '';
                    showStudentList.value = true;
                };

                // 处理专业选择
                const handleMajorSelect = (major) => {
                    selectedStudent.value = major;
                    showMajorMenu.value = false;
                    // 重置选中状态
                    selectedStudentRadio.value = '';
                    showStudentList.value = true;
                };

                // 确认学生选择
                const confirmStudentSelection = () => {
                    if (!selectedStudentRadio.value) {
                        ElMessage.warning('请选择一个学生');
                        return;
                    }
                    showStudentList.value = false;
                    // 保存选中的学生
                    ElMessage.success(`已选择 ${selectedStudentRadio.value} 同学`);
                    currentPage.value = 'student-detail';
                };

                // 处理专业点击
                const handleMajorClick = () => {
                    selectedStudent.value = '';
                    showMajorMenu.value = !showMajorMenu.value;
                    showCollegeMenu.value = false;
                };

                // 处理平行班选择
                const handleParallelClassSelect = (command) => {
                    if (!selectedParallelClasses.value.includes(command)) {
                        selectedParallelClasses.value.push(command);
                    }
                    showParallelClassMenu.value = false; // 关闭菜单
                    // 记录选择的平行班
                    selectedStudent.value = command;
                    // 重置选中状态
                    selectedStudentRadio.value = '';
                    showStudentList.value = true;
                };

                // 处理自然班选择
                const handleNaturalClassSelect = (command) => {
                    if (!selectedNaturalClasses.value.includes(command)) {
                        selectedNaturalClasses.value.push(command);
                    }
                    showNaturalClassMenu.value = false; // 关闭菜单
                    // 记录选择的自然班
                    selectedStudent.value = command;
                    // 重置选中状态
                    selectedStudentRadio.value = '';
                    showStudentList.value = true;
                };

                // 处理显示模态框
                const showModal = (title) => {
                    modalTitle.value = title;
                    modalVisible.value = true;
                    // 重置单选框状态
                    selectedStudentRadio.value = '';
                };

                // 处理确认选择（对话框版本）
                const confirmSelection = () => {
                    if (!selectedStudentRadio.value) {
                        ElMessage.warning('请选择一个学生');
                        return;
                    }
                    // 保存选中的学生
                    ElMessage.success(`已选择 ${selectedStudentRadio.value} 同学`);
                    modalVisible.value = false;
                    // 跳转到学生详细分析页面
                    currentPage.value = 'student-detail';
                };

                // 处理对话框关闭
                const handleDialogClose = () => {
                    selectedStudentRadio.value = '';
                };

                // 处理学院选择
                const selectDepartment = (department) => {
                    ElMessage.info(`您选择了${department}`);
                    showCollegeMenu.value = false;
                    // 显示学生选择对话框
                    showModal(department);
                };

                // 切换学院菜单显示状态
                const toggleCollegeMenu = () => {
                    showCollegeMenu.value = !showCollegeMenu.value;
                };

                // 点击其他地方关闭菜单
                onMounted(() => {
                    document.addEventListener('click', (e) => {
                        const collegeDropdown = document.querySelector('.college-dropdown');
                        if (collegeDropdown && !collegeDropdown.contains(e.target)) {
                            showCollegeMenu.value = false;
                        }
                    });
                    
                    // 添加监听URL锚点变化的事件处理
                    window.addEventListener('hashchange', () => {
                        if (window.location.hash === '#3') {
                            currentPage.value = '3';
                            activeMenu.value = '3';
                        }
                    });
                });

                const navigateToAnalysis = () => {
                    window.location.href = './pages/learning-analysis.html';
                };

                const goToCreateCourse = () => {
                    window.location.href = './pages/create-course.html';
                };

                const goToAddParallelClass = () => {
                    window.location.href = './pages/add-parallel-class.html';
                };

                const goToStudentManagement = () => {
                    window.location.href = './pages/student-management.html';
                };

                const goToHomeworkUpload = () => {
                    window.location.href = './pages/homework-upload.html';
                };

                const goToHomeworkEdit = () => {
                    window.location.href = './pages/homework-edit.html';
                };

                const goToHomeworkExam = () => {
                    window.location.href = './pages/homework-exam.html';
                };

                const goToTeacherAnalysis = () => {
                    window.location.href = './pages/teacher-analysis.html';
                };

                const goToUserManagement = () => {
                    window.location.href = './pages/user-management.html';
                };

                const navigateToGroupAnalysis = () => {
                    window.location.href = './pages/3.1.2.html';
                };

                const removeParallelClass = (index) => {
                    selectedParallelClasses.value.splice(index, 1);
                };

                const removeNaturalClass = (index) => {
                    selectedNaturalClasses.value.splice(index, 1);
                };

                // 新增取消选择方法
                const cancelStudentSelection = () => {
                    selectedStudentRadio.value = '';
                    showStudentList.value = false;
                };

                return {
                    currentPage,
                    activeMenu,
                    username,
                    searchQuery,
                    selectedStudent,
                    showStudentList,
                    modalVisible,
                    modalTitle,
                    showDropdown,
                    showCollegeMenu,
                    showMajorMenu,
                    showParallelClassMenu,
                    showNaturalClassMenu,
                    colleges,
                    majors,
                    selectedStudentRadio,
                    students,
                    handleMajorSelect,
                    confirmStudentSelection,
                    handleLogout,
                    handleIndividualAnalysis,
                    navigateToGroupAnalysis,
                    handleCollegeSelect,
                    handleMajorClick,
                    handleParallelClassSelect,
                    handleNaturalClassSelect,
                    showModal,
                    confirmSelection,
                    selectDepartment,
                    showStudentDetail,
                    backToIndividual,
                    backToAnalysis,
                    backToHome,
                    handleAnalysisClick,
                    handleSelect,
                    HomeFilled: ElementPlusIconsVue.HomeFilled,
                    Search: ElementPlusIconsVue.Search,
                    toggleCollegeMenu,
                    navigateToAnalysis,
                    goToCreateCourse,
                    goToAddParallelClass,
                    goToStudentManagement,
                    goToHomeworkUpload,
                    goToHomeworkEdit,
                    goToHomeworkExam,
                    goToTeacherAnalysis,
                    goToUserManagement,
                    selectedParallelClasses,
                    selectedNaturalClasses,
                    removeParallelClass,
                    removeNaturalClass,
                    cancelStudentSelection,
                    // 新增返回变量
                    searchForm,
                    parallelClassOptions,
                    naturalClassOptions,
                    studentData,
                    handleFilterChange,
                    handleSelectStudent
                };
            }
        });

        app.use(ElementPlus);

        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component);
        }

        app.mount('#app');
    </script>
</body>
</html>
